

### 文件系统包含什么

1、 索引节点（inode）
- 记录文件的元信息，比如inode编号、文件大小、访问权限、修改日期，访问位置等
- 索引节点和文件一一对应
2、 目录项（dentry）
- 记录文件名字、索引节点指针以及其他目录项的关联关系
- 由内核维护的一个内存数据结构，也被叫做目录项缓存
3、 逻辑块
4、 数据块

### 文件系统和磁盘的关系

![](./fs_disk.png)


磁盘在执行文件系统格式化的时候，会被分成三个存储区域
- 超级块：存储整个文件系统的状态
- 索引节点区：存储索引节点
- 数据块区： 存储数据块


### 有几种文件系统IO

#### 缓冲io/非缓冲io

是否通过标准库的缓存

#### 直接io/非直接io

- 直接io：跳过page cache直接和文件系统打交道
- 非直接io：page cache -> 系统调用 -> 写入磁盘


#### 阻塞io/非阻塞io

阻塞不阻塞当前线程

#### 同步io/异步io

返回是同步还是异步的


#### 什么是通用块层

- 向上：为文件系统或程序提供访问块设备的标准接口
- 向下：把各种异构的磁盘设备抽象为统一的块设备
- 整合io顺序：将文件系统/应用程序发来的io请求排队，并通过请求合并、重新排序提高读写效率

### IO栈包括哪些

![](./io_stack.png)

- 文件系统层（虚拟文件系统和其他文件系统的实现）：
    + 向上：为应用提供标准的文件访问接口
    + 向下：通过通用块层，来存储和管理磁盘数据
- 通用块层（设备IO队列和IO调度器）：
    + 向上：对文件系统的IO请求进行排队，在通过重新排序和请求合并
    + 向下：将上层的IO请求发送给设备层
- 设备层（存储设备和驱动程序）：
    + 负责最终物理设备的IO操作

### 磁盘性能指标

- 使用率：磁盘处理io的时间百分比
- 饱和度：磁盘处理io的繁忙程度
- IOPS：每秒的IO请求大小
- 响应时间：IO请求从发出到响应的时间

