
## 思考题：微信抢红包的高并发架构，应该采取什么样的负载均衡算法？谈谈你的分析和理解。

- 应用服务器的负载均衡，用于将任务请求分发到不同的服务器，这里采用的是轮询，因为比较快
- 数据服务的负载均衡，这里更适合根据红包ID进行hash负载均衡，将所有数据请求在同一台服务器上进行，防止多台服务器间的不同步问题。

https://www.infoq.cn/article/2017hongbao-weixin

## 总结

- 任务平均类：负载均衡系统将收到的任务平均分配给服务器进行处理
    + 数量上的平均：轮询
    + 权重上的平均：加权轮询
- 负载均衡类：根据后端服务器的负载进行分配
    + LVS 这种 4 层网络负载均衡设备，可以以“连接数”来判断服务器的状态，服务器连接数越大，表明服务器压力越大。
    + Nginx 这种 7 层网络负载系统，可以以“HTTP 请求数”来判断服务器状态
    + 如果我们自己开发负载均衡系统，可以根据业务特点来选择指标衡量系统压力
        + 如果是 CPU 密集型，可以以“CPU 负载”来衡量系统压力
        + 如果是 I/O 密集型，可以以“I/O 负载”来衡量系统压力
- 性能最优类： 负载均衡系统根据服务器的响应时间来进行任务分配，优先将新任务分配给响应最快的服务器。
    + 站在服务器的角度设计的
    + 负载均衡系统要收集和分析后端服务器性能，消耗性能
    + 采取抽样的方式降低消耗，即不统计所有任务的响应时间，而是抽样统计部分任务的响应时间来估算整体任务的响应时间
    + 采样周期又是一个问题
- Hash 类：负载均衡系统根据任务中的某些关键信息进行 Hash 运算，将相同 Hash 值的请求分配到同一台服务器上
    + 源Hash类：将来源于同一个源 IP 地址的任务分配给同一个服务器进行处理，适合于存在事务、会话的业务。
    + ID Hash类：将某个 ID 标识的业务分配到同一个服务器中进行处理，这里的 ID 一般是临时性数据的 ID（如 session id）
