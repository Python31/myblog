
## 思考：分享一下你所在的业务发生过哪些因为缓存导致的线上问题？采取了什么样的解决方案？效果如何？

- 双key策略：要缓存的key过期时间是t，key1没有过期时间。每次缓存读取不到key时就返回key1的内容，然后触发一个事件。这个事件会同时更新key和key1。


## 总结

针对场景：
- 需要经过复杂运算后得出的数据，存储系统无能为力
- 读多写少的数据，存储系统有心无力

### 缓存穿透

含义： 缓存没有发挥作用，业务系统继续去存储系统查询数据


1. 数据不存在
    + 场景： 存储系统中没有这个数据
    + 如果有黑客故意大量访问没有的数据，可以在第一次访问的时候，如果存储系统也查不到就设置一个默认值
2. 缓存数据生成耗费大量时间或者资源
    + 场景：缓存刚好失效

### 缓存雪崩

含义： 缓存失效（过期）后引起系统性能的急剧下降。
当缓存过期被清除的时候，业务系统需要重新生成缓存，因此需要再次访问存储系统，消耗计算，浪费时间。


常见解决办法：
1. 更新锁
    + 缓存更新只限制一个线程，如果是分布式的话，就要用分布式锁
2. 后台更新
    + 后台来更新缓存而不是业务系统
    + 业务线程发现缓存失效之后，通过向消息队列发送一条消息通知后台去更新缓存。

### 缓存热点

含义：可能多个业务命中同一份缓存，则对缓存这份数据的缓存服务器有很大的压力。比如明星发微博

解决方案：
- 缓存热点的解决方案就是复制多份缓存副本，将请求分散到多个缓存服务器上，减轻缓存热点导致的单台缓存服务器压力
- 不要设置一样的缓存时间


## 评论区

### 缓存设计方案

1. 什么数据该缓存
2. 什么时机触发缓存以及触发的方式是什么
3. 缓存的层次和力度（网关缓存如 nginx，本地缓存如单机文件，分布式缓存如redis cluster，进程内缓存如全局变量）
4. 缓存的命名规则和失效规则
5. 缓存的监控指标和故障应对方案
6. 可视化缓存数据如 redis 具体 key 内容和大小
