!function(t){var e=t.module("myBlog.controllers.index",["ngRoute"]);e.config(["$routeProvider",function(t){t.when("/detail/:articleid",{templateUrl:"./controllers/articleDetail/view.html",controller:"ArticleDetail"})}]),e.controller("ArticleDetail",["$scope","$route","$routeParams","$http","$location","localStorageService","commentService","articleDetailCategory","markd",function(t,e,a,o,i,r,m,n,c){t.commentFormData={nick:r.get("nick")||"",email:r.get("email")||""},t.dirname=i.$$absUrl;var l=a.articleid;t.replayComment=function(t){cid=$(t.target).data("cid"),tid=$(t.target).data("tid"),r.set("cid",cid),r.set("tid",tid)},t.addComment=function(){var e=r.get("nick"),a=r.get("email"),o=r.get("cid")||"",n=r.get("tid")||"";if(r.remove("cid"),r.remove("tid"),e&&t.commentFormData.email==a){if(t.commentFormData.email==a&&t.commentFormData.nick!=e)return void alert("请不要更换用户名："+e);if(t.commentFormData.email!=a||e!=t.commentFormData.nick)return;m.findExistUser(t.commentFormData.nick).then(function(e){t.commentFormData.from=e.data._id,t.commentFormData.article=t.article._id,t.commentFormData.cid=o,t.commentFormData.tid=n,m.saveComment(t.commentFormData,function(t){location="/#!"+i.$$path})})}else m.saveUser(t.commentFormData).then(function(e){t.commentFormData.from=e.data._id,t.commentFormData.article=t.article._id,t.commentFormData.cid=o,t.commentFormData.tid=n,m.saveComment(t.commentFormData,function(){location="/#!"+i.$$path})})},n.getCategory(l).then(function(t){return n.getCategoryOtherArticle(t)}).then(function(e){if(!e.data)return[];var a=e.data.list.splice(0,5);return t.catgoryName=e.data.name,n.getArticleList(a)}).then(function(e){t.articleList=e}),c.renderMD(l,function(e){t.article=e,$("#marked").html(marked(e.content)),$("pre code").each(function(t,e){hljs.highlightBlock(e)}),c.renderComment(t.article._id,function(e){t.comments=e})})}])}(angular);